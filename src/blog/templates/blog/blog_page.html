{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags wagtailmarkdown %}

{% block content %}
<div class="post-layout">
    <article class="post">
        <header class="post-header">
            <h1 class="post-title">{{ page.title }}</h1>
            {% if page.date %}
                <p class="post-meta">
                    <time datetime="{{ page.date|date:'Y-m-d' }}">{{ page.date }}</time>
                </p>
            {% endif %}
            <div class="post-readtime" id="postReadTime" aria-live="polite">
                <span class="post-readtime__main">Main path: {{ readtime_main|default:"-- min" }}</span>
                <span class="post-readtime__divider">â€¢</span>
                <span class="post-readtime__deep">With deep dives: {{ readtime_deep|default:"-- min" }}</span>
            </div>
        </header>

        {% if page.featured_image %}
            {% image page.featured_image width-800 as img %}
            <img src="{{ img.url }}" alt="{{ page.title }}" class="featured-image">
        {% endif %}

        <div class="content post-content">
            {% if body_html %}
                {{ body_html|safe }}
            {% else %}
                {% for block in page.body %}
                    {% include "blog/blocks/render_block.html" with block=block %}
                {% endfor %}
            {% endif %}
        </div>
    </article>

    {% if toc_items %}
        <aside class="post-sidebar" aria-label="Post navigation">
            <div class="post-toc">
                <div class="post-toc__progress">
                    <span class="post-toc__progress-bar" id="postTocProgress"></span>
                </div>
                <div class="post-toc__header">
                    <div class="post-toc__eyebrow">You are here</div>
                    <div class="post-toc__crumb" id="postTocCrumb">{{ toc_crumb|default:"On this page" }}</div>
                </div>
                <div class="post-toc__title">On this page</div>
                <nav class="post-toc__nav" aria-label="Table of contents">
                    <ul class="post-toc__list" id="postTocList">
                        {% for item in toc_items %}
                            <li class="post-toc__item post-toc__item--{{ item.level }}" data-level="{{ item.level }}">
                                <a
                                    class="post-toc__link"
                                    href="#{{ item.id }}"
                                    data-toc-id="{{ item.id }}"
                                    {% if item.parent_id %}data-parent-id="{{ item.parent_id }}"{% endif %}
                                    {% if item.grandparent_id %}data-grandparent-id="{{ item.grandparent_id }}"{% endif %}
                                >
                                    {{ item.text }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </nav>
            </div>
        </aside>
        <div class="post-toc-backdrop" id="postTocBackdrop" aria-hidden="true"></div>
    {% endif %}
</div>

<nav class="post-nav">
    <a href="{{ page.get_parent.url }}">&larr; Back to posts</a>
</nav>
{% endblock %}

{% block header_actions %}
{% if toc_items %}
    <button class="post-toc-drawer-toggle" id="postTocDrawerToggle" type="button" aria-expanded="false">
        <span class="post-toc-drawer-toggle__icon" aria-hidden="true"><span></span></span>
        <span class="post-toc-drawer-toggle__label">Outline</span>
    </button>
{% endif %}
{% endblock %}

{% block extra_js %}
<script defer src="{% static 'js/blog-post.js' %}"></script>
{% endblock %}
